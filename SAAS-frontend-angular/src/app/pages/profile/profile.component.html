<div class="container py-4">
    <!-- Page heading -->
    <div class="mb-4">
      <h1 class="h3 mb-1">User Profile</h1>
      <p class="text-muted mb-0">
        View your account details and subscription information.
      </p>
    </div>
  
    <div class="card shadow-sm">
      <div class="card-body">
        <!-- Full Name -->
        <div class="row mb-3 align-items-center">
          <label class="col-sm-3 col-form-label fw-semibold">
            Name
          </label>
          <div class="col-sm-9">
            <p class="form-control-plaintext mb-0">
              {{ profile?.name || '—' }}
            </p>
          </div>
        </div>
  
        <!-- Username -->
        <div class="row mb-3 align-items-center">
          <label class="col-sm-3 col-form-label fw-semibold">
            Username
          </label>
          <div class="col-sm-9">
            <p class="form-control-plaintext mb-0">
              {{ username || '—' }}
            </p>
          </div>
        </div>
  
        <!-- Email -->
        <div class="row mb-3 align-items-center">
          <label class="col-sm-3 col-form-label fw-semibold">
            Email
          </label>
          <div class="col-sm-9">
            <p class="form-control-plaintext mb-0">
              {{ profile?.email || '—' }}
            </p>
          </div>
        </div>
  
        <!-- Password + Change Password button -->
        <div class="row mb-3 align-items-center">
          <label class="col-sm-3 col-form-label fw-semibold">
            Password
          </label>
          <div class="col-sm-9 d-flex align-items-center gap-2">
            <p class="form-control-plaintext mb-0 flex-grow-1">
              {{ maskedPassword || '••••••••••' }}
            </p>
            <button
              type="button"
              class="btn btn-outline-secondary btn-sm"
              (click)="openChangePassword()"
            >
              Change Password
            </button>
          </div>
        </div>
  
        <!-- Plan + Change Plan button -->
        <div class="row mb-3 align-items-center">
          <label class="col-sm-3 col-form-label fw-semibold">
            Plan
          </label>
          <div class="col-sm-9 d-flex align-items-center gap-2">
            <p class="form-control-plaintext mb-0 flex-grow-1">
              {{ planLabel|| 'Basic' }}
            </p>
            <button
              type="button"
              class="btn btn-outline-primary btn-sm"
              (click)="openChangePlan()"
            >
              Change Plan
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

<!-- Change Password Modal -->
<div class="modal-backdrop" *ngIf="showChangePassword">
  <div class="modal-dialog">
    <div class="modal-card">
      <h2 class="mb-3">Change Password</h2>

      <div class="mb-3">
        <label class="form-label">New Password</label>
        <div class="input-group">
          <input
            [type]="showNewPassword ? 'text' : 'password'"
            class="form-control"
            [(ngModel)]="newPassword"
            [disabled]="passwordLoading"
          />
          <button
            class="btn btn-outline-secondary"
            type="button"
            (click)="showNewPassword = !showNewPassword"
            [disabled]="passwordLoading"
          >
            {{ showNewPassword ? 'Hide' : 'View' }}
          </button>
        </div>
      </div>

      <div class="mb-3">
        <label class="form-label">Confirm Password</label>
        <div class="input-group">
          <input
            [type]="showConfirmPassword ? 'text' : 'password'"
            class="form-control"
            [(ngModel)]="confirmPassword"
            [disabled]="passwordLoading"
          />
          <button
            class="btn btn-outline-secondary"
            type="button"
            (click)="showConfirmPassword = !showConfirmPassword"
            [disabled]="passwordLoading"
          >
            {{ showConfirmPassword ? 'Hide' : 'View' }}
          </button>
        </div>
      </div>

      <div *ngIf="passwordError" class="alert alert-danger py-2">
        {{ passwordError }}
      </div>

      <div *ngIf="passwordSuccess" class="alert alert-success py-2">
        {{ passwordSuccess }}
      </div>

      <div class="d-flex justify-content-end gap-2 mt-4">
        <button
          type="button"
          class="btn btn-outline-secondary"
          (click)="closeChangePassword()"
          [disabled]="passwordLoading"
        >
          Cancel
        </button>
        <button
          type="button"
          class="btn btn-primary"
          (click)="submitPasswordChange()"
          [disabled]="passwordLoading"
        >
          {{ passwordLoading ? 'Saving...' : 'Save Password' }}
        </button>
      </div>
    </div>
  </div>
</div>


<!-- Change Plan Modal -->
<div class="modal-backdrop" *ngIf="showChangePlan">
  <div class="modal-dialog">
    <div class="modal-card">
      <h2 class="mb-3">Change Subscription Plan</h2>

      <div class="mb-3">
        <label class="form-label">Select Plan</label>
        <select
          class="form-select"
          [(ngModel)]="selectedPlan"
          [disabled]="planLoading"
        >
          <option value="basic">Basic</option>
          <option value="premium">Premium</option>
          <option value="pro">Pro</option>
        </select>
      </div>

      <div *ngIf="planError" class="alert alert-danger py-2">
        {{ planError }}
      </div>

      <div *ngIf="planSuccess" class="alert alert-success py-2">
        {{ planSuccess }}
      </div>

      <div class="d-flex justify-content-end gap-2 mt-4">
        <button
          type="button"
          class="btn btn-outline-secondary"
          (click)="closeChangePlan()"
          [disabled]="planLoading"
        >
          Cancel
        </button>
        <button
          type="button"
          class="btn btn-primary"
          (click)="submitPlanChange()"
          [disabled]="planLoading"
        >
          {{ planLoading ? 'Saving...' : 'Save Plan' }}
        </button>
      </div>
    </div>
  </div>
</div>